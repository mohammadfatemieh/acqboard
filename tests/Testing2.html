<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="content-type">
  <title>Soma Acq Board Testingg</title>
</head>
<body>
<span style="font-weight: bold; text-decoration: underline;">11 March
2006</span>: Acqboard 01<br
 style="font-weight: bold; text-decoration: underline;">
<br>
Detailed test and assembly log for Acqboard 01: Digital side<br>
<span style="font-weight: bold;"><br>
</span>
<ol>
  <li><span style="font-weight: bold;">First, we solder up the digital
power</span></li>
  <li><span style="font-weight: bold;">Solder QFp, etc</span></li>
  <li><span style="font-weight: bold;">All back-of-board bypass caps
are 0.1 uF Caps</span></li>
</ol>
Everyting soldered and documented; now try programming -- worked. <br>
<br>
<span style="font-weight: bold; font-style: italic;">Now the analog
side -- first isolators, then the power supply <br>
<br>
Analog references appear to work properly. <br>
<br>
We had to use non-recently-purchased 150 uf Caps, 311-1071-1-ND,
CC0603JRNP09BN151 from digikey. <br>
<br>
</span><span style="font-weight: bold;"><span
 style="text-decoration: underline;">13 March 2006<br>
<br>
</span></span>Informal performance measurements of the ADC + AA look
correct. Soldering on registers and the other hardware for further
measurement.&nbsp; <br>
<br>
With the ADCs, AAs, and PGAs, but without any earlier-stage muxes, and
with the inputs all ganged together, we get :<br>
<br>
<br>
Now, we solder on : <br>
1. the rest of the channel's bypass caps<br>
2. The Mux and amp<br>
3. the 5.6k Resistor<br>
4. <span style="font-style: italic;"><span style="font-weight: bold;">We
ordered the wrong 68nF caps, so we're jusing 490-3360-1-ND, a 1206 COG.
<br>
<br>
<br>
</span></span><span
 style="text-decoration: underline; font-weight: bold;">14 March 2006<br>
</span><span style="font-style: italic;"><span
 style="font-weight: bold;"><span style="font-style: italic;"><br>
</span></span></span><span style="font-weight: bold;"></span><span
 style="font-style: italic;"><span style="font-weight: bold;">Our
results are as follows for the boards which have everything but the IN-A<br>
<br>
<img alt=""
 src="results/20060313/just_adc_aa_pga.A1.noshortedinputs.png"
 style="width: 600px; height: 450px;"><br>
<br>
<br>
<span style="font-weight: bold;"><span style="font-style: italic;">This
is confusing and unfortunate. </span></span></span><span
 style="font-style: italic;"><span style="text-decoration: underline;"><br>
<br>
<span style="text-decoration: underline;"></span></span></span></span>Further
refinement along the analysis end has show that, for high gains using
the LPF, we end up with awful nonlinearities. <br>
<br>
Below is the difference over serveral cycles between the recorded sine
and the fit sine for a gain of 5 with the HPF enabled. <br>
<br>
<img alt="" src="results/20060314/hpf_minus_model.png"
 style="width: 1200px; height: 900px;"><br>
<span style="text-decoration: underline;"><span
 style="font-style: italic;"></span></span><span
 style="font-style: italic;"><span style="font-style: italic;"><span
 style="text-decoration: underline;"></span></span><span
 style="font-weight: bold;"><span style="font-weight: bold;"><span
 style="font-style: italic;"></span></span>I don't know what this is. <br>
<br>
Resoldering the Mux appears to have fixed the problem: <br>
<br>
</span></span>
<table style="width: 100%; text-align: left;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;"><img alt=""
 src="results/20060314/All.A1.png" style="width: 400px; height: 300px;"><br>
      </td>
      <td style="vertical-align: top;"><img alt=""
 src="results/20060314/All.B1.png" style="width: 400px; height: 300px;"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><br>
      </td>
      <td style="vertical-align: top;"><br>
      </td>
    </tr>
  </tbody>
</table>
<span style="font-style: italic;"><span style="font-weight: bold;"><br>
</span></span><span
 style="text-decoration: underline; font-weight: bold;">15 March 2006</span><br
 style="text-decoration: underline; font-weight: bold;">
Now we try with the in-amps, AD8221AR. We use ERJ-3EKF1004V
(P1.00MHCT-ND) resistors, 1 MOhm, and 1 uf Caps. <br>
<br>
Things looked great, but now we're seeing a ton of non-HPF THD+N
variance. To measure this, I've removed the mux and am just directly
measuring the HPF-less signal chain. <br>
<br>
Here is B1 initially, with an entire signal chain: <br>
<img alt="" src="results/20060315/B1.g100.pre-test.png"
 style="width: 600px; height: 450px;"><br>
<br>
It looks great. The associated data is at B1.good.h5.&nbsp; (note this
is with segnum = 100) <br>
<br>
If we want we can seriously overdrive the ADC -- -1.8V to 4.2V! <br>
<br>
This doesn't appear to cause any noticable difference, however, in the
measured response. <br>
<br>
Cleaned off the flux, now let's look... no real difference. <br>
<br>
<span style="font-weight: bold; text-decoration: underline;">16 March
2006</span><br style="font-weight: bold; text-decoration: underline;">
<br>
Trying hard to be more rigorous here. It's not even obvious what we're
measuring or how/why we should care. To that effect, I think that the
current plots are not very useful/effective. <br>
<br>
<span style="font-weight: bold;">test.70.h5</span>: Both channels A1
and B1 soldered; A1 Ac-coupling caps removed; using All-Chan connector.
<br>
<br>
<br>
<span style="font-weight: bold; text-decoration: underline;">17 March
2006</span><br style="font-weight: bold; text-decoration: underline;">
We continue, even after substantial refactoring of sine-fitting code,
to get unfortunate-looking results. <br>
<br>
As a test, first thing in the morning, we will record: Both channels A1
and B1 soldered; A1 Ac-coupling caps removed; using All-Chan connector.
<br>
<br>
<br>
<img alt="" src="results/20060317/early.B1.png"
 style="width: 600px; height: 450px;"><br>
Note that, contrary to what the graph says, the signals with high
variance actually have the HPF -off-. I don't think what results is a
problem with sine convergence, because we clearly have results
-converging-, and there is a very clear difference between the HPF
off-and-on states. This data is in early.B1.h5. <br>
<br>
<br>
Test Plans -- to develop comprehensive testing, we're going to record
noise data and sine data across HPF and LPF. <br>
<br>
<br>
<br>
<span style="font-weight: bold; text-decoration: underline;">18 March
2006</span><br style="font-weight: bold; text-decoration: underline;">
<br>
I think it's more important to try and characterize the nature of our
observed problem: <br>
1. Is it real ? <br>
2. why does it vary with segment size? <br>
3. What is the spectral relation? <br>
<br>
Here, we have the results of B1, gain = 100, hpf = 0, sine, a few
sines. <br>
<br>
<img alt="" src="results/20060318/B1.original.gain100.hpf0.THDn.png"
 style="width: 600px; height: 716px;"><br>
<br>
<br>
THD+N for various frequencies across a series of frequencies. <br>
<br>
There is more low-frequency noise in the hpf=off, so it makes sense
that fitting over smaller windows would be tighter. <br>
<br>
I'm going to try filtering the data and then seeing what we get. <br>
<br>
<table style="width: 100%; text-align: left;" border="1" cellpadding="2"
 cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;"><img alt=""
 src="results/20060318/B1.original.gain100-hpf1.thdns.png"
 style="width: 400px; height: 300px;"><br>
      </td>
      <td style="vertical-align: top;"><img alt=""
 src="results/20060318/B1.original.gain100-hpf0.thdns.png"
 style="width: 400px; height: 300px;"><br>
      </td>
      <td style="vertical-align: top;"><img alt=""
 src="results/20060318/B1.original.gain100-hpf0-filtered.thdns.png"
 style="width: 400px; height: 300px;"><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;">THD+N across multiple segment
sizes for 2.6k, gain = 100, with HPF on <br>
      </td>
      <td style="vertical-align: top;">THD+N across multiple segment
sizes for 2.6k, gain = 100, with HPF on </td>
      <td style="vertical-align: top;">THD+N across multiple segment
sizes for 2.6k, gain = 100, with HPF on, filtered with <br>
      </td>
    </tr>
  </tbody>
</table>
<br>
Note that when we (digitally) filter, we get a much flatter response
(minus the edges, an artifact of filtering). And notice that the same
thing happens when we reduce the segment size. My best conclusion is
that we have some low-freqency noise (surprise!) that gets filtered out
by the HPF, and that causes the problems we see in the LPF. <br>
<br>
<br>
<span style="font-style: italic;"><span style="font-weight: bold;"></span></span><span
 style="font-weight: bold; font-style: italic;"></span>
</body>
</html>
